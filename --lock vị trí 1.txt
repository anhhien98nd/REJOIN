-- üå∏ Auto TP1 Lock 3 Giai ƒêo·∫°n (S·ª≠a l·ªói)
local Players = game:GetService("Players")
local p = Players.LocalPlayer
local STATE = { tp1 = false }

-- H√†m ch·ªù character + hrp s·∫µn s√†ng
local function waitForHRP()
    local t0 = tick()
    local chr = p.Character or p.CharacterAdded:Wait()
    local hrp = chr:FindFirstChild("HumanoidRootPart")
    local waited = 0
    while not hrp and waited < 5 do
        task.wait(0.2)
        waited = waited + 0.2
        chr = p.Character or p.CharacterAdded:Wait()
        hrp = chr:FindFirstChild("HumanoidRootPart")
    end
    return hrp
end

-- H√†m Lock v·ªã tr√≠
local function startLock(pos)
    if STATE.tp1 then return end
    STATE.tp1 = true
    print("[AUTO] üîí B·∫Øt ƒë·∫ßu lock v·ªã tr√≠ t·∫°i:", tostring(pos))

    -- c·∫≠p nh·∫≠t look t·ª´ HRP n·∫øu c√≥
    local hrp = waitForHRP()
    local look
    if hrp then
        pcall(function()
            look = hrp.CFrame.LookVector
        end)
    end

    task.spawn(function()
        while STATE.tp1 do
            task.wait()
            local c = p.Character
            if c then
                local h = c:FindFirstChild("HumanoidRootPart")
                if h then
                    -- d√πng Vector3.new(0,0,0) ƒë·ªÉ reset velocity (ƒë√∫ng)
                    pcall(function()
                        h.Velocity = Vector3.new(0,0,0)
                        if look then
                            h.CFrame = CFrame.new(pos, pos + look)
                        else
                            h.CFrame = CFrame.new(pos)
                        end
                    end)
                end
            end
        end
    end)
end

-- H√†m stop
local function stopLock()
    if STATE.tp1 then
        STATE.tp1 = false
        print("[AUTO] üîì D·ª´ng lock v·ªã tr√≠.")
    end
end

-- Main sequence 3 giai ƒëo·∫°n
task.spawn(function()
    local pos = Vector3.new(40, 3.63, -130.14)

    -- Giai ƒëo·∫°n 1: b·∫≠t sau 10s, t·∫Øt t·∫°i 77s (t·ª©c ch·∫°y 67s sau khi b·∫≠t)
    task.wait(10)
    startLock(pos)
    task.wait(67) -- ch·∫°y ƒë·∫øn 77s t·ªïng
    stopLock()
    print("[AUTO] ‚úÖ K·∫øt th√∫c giai ƒëo·∫°n 1 t·∫°i 77s")

    -- Giai ƒëo·∫°n 2: b·∫≠t l·∫°i t·∫°i 89s, t·∫Øt t·∫°i 151s
    task.wait(12) -- 77 -> 89
    startLock(pos)
    print("[AUTO] üîÅ B·∫≠t l·∫°i TP1 Lock t·∫°i gi√¢y 89")
    task.wait(62) -- 89 -> 151
    stopLock()
    print("[AUTO] ‚úÖ T·∫Øt TP1 Lock l·∫ßn 2 t·∫°i gi√¢y 151")

    -- Giai ƒëo·∫°n 3: b·∫≠t l·∫°i t·∫°i 176s, t·∫Øt t·∫°i 228s
    task.wait(25) -- 151 -> 176
    startLock(pos)
    print("[AUTO] üîÅ B·∫≠t l·∫°i TP1 Lock t·∫°i gi√¢y 176")
    task.wait(52) -- 176 -> 228
    stopLock()
    print("[AUTO] ‚úÖ T·∫Øt TP1 Lock l·∫ßn 3 t·∫°i gi√¢y 228")
end)
